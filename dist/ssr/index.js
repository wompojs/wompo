import{registeredComponents as b}from"../wompo.js";export const ssr=(s,t)=>{const o={count:0,cCounter:0,components:{},props:{}};let e=w(s,t,o);e=e.replace(/\s[a-z]+="\$wcREMOVE\$"/g,"");const l={},m=o.components;for(const r in m){const $=m[r].options.generatedCSS;$&&(l[r]=$.replace(/\s\s+/g," ").replace(/\t/g,"").replace(/\n/g,""))}return{html:e,css:l,props:o.props}};const w=(s,t,o)=>{let e="";const{generatedCSS:l,styles:m,shadow:r}=s.options;t.styles=m;const i=s.componentName;o.props[i]||(o.props[i]=[]),e+=`<${i} wompo-hydrate="${o.props[i].length}"`;for(const n in t){const c=t[n];c!==Object(c)&&n!=="title"&&(e+=` ${n}="${c}"`)}e+=">",r&&(e+='<template shadowrootmode="open">'),l&&(e+=`<link rel="stylesheet" href="/${i}.css" />`),o.components[i]=s;const $=s(t);delete t.children;//! Maybe remove when implementing hydration
o.props[i].push(t);let p=S($,o);p=p.replace(/<([a-z]*-[a-z]*)(.*?)>/gs,(n,c,y)=>n.endsWith("/>")?`<${c}${y.substring(0,y.length-1)}></${c}>`:n);let g=0,f="";const d=[];p=p.replace(/<\/?([a-z]+?-[a-z]+?)\s?(?:\s.*?)?>/gs,(n,c)=>{if(!b[c])return n;if(n[1]!=="/"){if(c===f)g++;else if(!f){f=c;const u=n+`<?$CWC${d.length}>`;return g++,u}}else if(f&&c===f&&(g--,!g)){const u=`</?$CWC${d.length}>`+n;return f="",d.push(d.length),u}return n});for(const n of d){const c=new RegExp(`<([a-z]+-[a-z]+)([^>]*?)><\\?\\$CWC${n}>(.*?)<\\/\\?\\$CWC${n}>`,"gs");p=p.replace(c,(y,u,P,j)=>{const k=b[u],h={};h.children={_$wompoChildren:!0,nodes:j};const R=P.matchAll(/\s?(.*?)="(.*?)"/gs);let a;for(;!(a=R.next()).done;){const[_,W,C]=a.value;if(C.match(/\$wc(.*?)\$/)){const z=o[C];h[W]=z}else h[W]=C}return w(k,h,o)})}return e+=p,r&&(e+="</template>"),e+=`</${i}>`,e},S=(s,t)=>{let o="";for(let e=0;e<s.parts.length;e++){let l=s.parts[e];const m=s.values[e];o+=l,o+=O(l,m,t)}return o},O=(s,t,o)=>{let e="";const l=t===!1||t===void 0||t===null,m=t!==Object(t);if(s.endsWith("=")){if(l)return e+='"$wcREMOVE$"',e;if(m)e+=`"${t}"`;else if(s.endsWith(" style=")){let r="";const i=Object.keys(t);for(const $ of i){let p=t[$],g=$.replace(/[A-Z]/g,f=>"-"+f.toLowerCase());typeof p=="number"&&(p=`${p}px`),r+=`${g}:${p};`}e+=`"${r}"`}else{const r=`$wc${o.count}$`;e+=`"${r}"`,o[r]=t,o.count++}return e}if(l)return e;if(t._$wompoF)return e+=t.componentName,e;if(t._$wompoChildren)return e+=t.nodes,o.cCounter++,e;if(m)return e+=t,e;if(Array.isArray(t)){for(const r of t)e+=O(s,r,o);return e}return t._$wompoHtml?S(t,o):e};
